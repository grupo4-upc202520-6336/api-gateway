server:
  port: 8080 # El puerto est�ndar del Gateway

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      # Habilitar CORS globalmente para que Angular no se queje
      globalcors:
        cors-configurations:
          '[/**]':
            # allowedOrigins: "*"
            allowedOrigins:
              - "http://localhost:4200"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
            allowedHeaders: "*"
      
      routes:
        # --- RUTA 1: IAM SERVICE (Usuarios y Roles) ---
        - id: iam-service
          uri: lb://IAM-SERVICE  # "lb" = Load Balancer (Busca en Eureka)
          predicates:
            # Si la URL empieza con esto, m�ndalo al IAM
            - Path=/api/v1/authentication/**, /api/v1/users/**, /api/v1/roles/**

        # --- RUTA 2: PROFILE SERVICE (Productores y Distribuidores) ---
        - id: profile-service
          uri: lb://PROFILE-SERVICE # Aseg�rate que coincida con spring.application.name del profile
          predicates:
            - Path=/api/v1/profiles/**

        # --- RUTA 3: STORE SERVICE (Productos y Pagos) ---
        - id: store-service
          uri: lb://STORE-SERVICE
          predicates:
            - Path=/api/v1/products/**, /api/v1/payment-products/**

        # --- RUTA 4: FIELDS SERVICE (Campos y Trabajadores) ---
        - id: fields-service
          uri: lb://FIELDS-SERVICE
          predicates:
            - Path=/api/v1/fields/**, /api/v1/workers/**

        # --- RUTA 5: AGRICULTURAL PROCESS SERVICE ---
        - id: process-service
          uri: lb://AGRICULTURAL-PROCESS-SERVICE
          predicates:
            - Path=/api/v1/agricultural-processes/**

        # --- 6. PAYMENT SERVICE (Pagos) ---
        # (NUEVO: Asegúrate de que su controller empiece con /api/v1/payments)
        - id: payment-service
          uri: lb://PAYMENT-SERVICE
          predicates:
            - Path=/api/v1/payments/**

        # --- 7. SUBSCRIPTION SERVICE (Suscripciones) ---
        # (NUEVO: Asegúrate de que su controller empiece con /api/v1/subscriptions)
        - id: subscription-service
          uri: lb://SUBSCRIPTION-SERVICE
          predicates:
            - Path=/api/v1/subscriptions/**

        # --- 8. FINANCES SERVICE (Finanzas) ---
        # (NUEVO: Asegúrate de que su controller empiece con /api/v1/finances)
        - id: finances-service
          uri: lb://FINANCES-SERVICE
          predicates:
            - Path=/api/v1/finances/**

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
  instance:
    prefer-ip-address: true

# Configuraci�n de Seguridad (Token)
# Debe ser EXACTAMENTE la misma clave que en iam-service
authorization:
  jwt:
    secret: 8Zz5tw0Ionm3XPZZfN0NOml3z9FMfmpgXwovR9fp6ryDIoGRM8EPHAB6iHsc0fb